r Hot reload.
R Hot restart.
h List all available interactive commands.
d Detach (terminate "flutter run" but leave application running).
c Clear the screen
q Quit (terminate the application on the device).7


flutter run




onToggle: (value) async {
  final alarmId = alarm['id'] as int;

  // 1️⃣ Update DB first
  await AlarmDatabase.instance.update(
    alarmId,
    {
      'minutesSinceMidnight': alarm['minutesSinceMidnight'],
      'isActive': value ? 1 : 0,
      'label': alarm['label'],
      'days': alarm['days'],
      'music': alarm['music'],
    },
  );

  // 2️⃣ Schedule or cancel the notification
  final notifier = AlarmNotificationController();

  final minutes = alarm['minutesSinceMidnight'] as int;
  final hour = minutes ~/ 60;
  final minute = minutes % 60;
  final label = alarm['label'] ?? 'Alarm';
  final music = alarm['music'] ?? 'songs/alarm.mp3';
  final selectedDays = (alarm['days'] as String?)?.split(',') ?? [];

  if (value) {
    // Active → schedule
    if (selectedDays.isEmpty) {
      final now = DateTime.now();
      final next = DateTime(now.year, now.month, now.day, hour, minute);
      final target = next.isBefore(now) ? next.add(const Duration(days: 1)) : next;

      await notifier.scheduleOneTimeAlarm(
        id: alarmId,
        dateTime: target,
        label: label,
        musicPath: music,
      );
    } else {
      await notifier.scheduleRepeatingAlarm(
        id: alarmId,
        label: label,
        hour: hour,
        minute: minute,
        weekdays: selectedDays,
        musicPath: music,
      );
    }
  } else {
    // Inactive → cancel
    await notifier.cancelAlarm(alarmId);
  }

  // 3️⃣ Refresh UI
  _loadAlarms();
},
